{% load static %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<div class="ps-5" id="{{comment.id}}">
    <div class="border-start border-bottom rounded-bottom border-2 p-2 border-dark border-opacity-25">    

    

        <div class="d-flex align-items-center">
            
            <div class="flex-shrink-0 align-self-start">
                
                <div class="circle-img img-circle">
                    {% if comment.author.profile.profile_img %}
                    <img src="{{ comment.author.profile.profile_img.url }}" class="img-fluid rounded-circle" alt="profile_img"> 
                    {% else %}
                    <img src="{% static 'theBlog/images/avatar.jpg' %}" class="img-fluid rounded-circle" alt="profile_img">
                    {% endif %}
                </div>

            </div>
            <div class="p-2 flex-grow-1 flex-column">
                <div class="d-flex flex-row justify-content-start">
                    <div class="p-0 pe-5">
                        <h6 class="card-title">{{comment.author.first_name}} {{comment.author.last_name}}</h6>
                        <small class="text-muted" title='Create: {{ comment.created|date:"Y/m/d g:i a" }} - Edit: {{ comment.updated|date:"Y/m/d g:i a" }}'>
                            {{ comment.created.date|timesince }} ago                
                        </small>
                    </div>
                    <div class="p-0 ps-2 pe-1">
                        
                        <span class="check-icon" id="check-icon-{{comment.id}}" title="solution">
                            {% if post.solved_by_comment == comment.id %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-check2 text-success" viewBox="0 0 16 16">
                                <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                                </svg>
                            {% endif %}
                        </span>

                    </div>
                    <div class="p-0 ps-2 pe-1">
                        <span class="endorse-icon" id="endorse-icon-{{comment.id}}" title="endorsed" style="position:relative; top:6px;">
                            {% if comment.endorsed %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-award text-primary" viewBox="0 0 16 16">
                                <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68L9.669.864zm1.196 1.193.684 1.365 1.086 1.072L12.387 6l.248 1.506-1.086 1.072-.684 1.365-1.51.229L8 10.874l-1.355-.702-1.51-.229-.684-1.365-1.086-1.072L3.614 6l-.25-1.506 1.087-1.072.684-1.365 1.51-.229L8 1.126l1.356.702 1.509.229z"/>
                                <path d="M4 11.794V16l4-1 4 1v-4.206l-2.018.306L8 13.126 6.018 12.1 4 11.794z"/>
                              </svg>
                            {% endif %}
                        </span>
                    </div>
                    <div class="p-0 ps-2 pe-1">
                        <span class="archived-icon" id="archived-icon-{{comment.id}}" title="archived" style="position:relative; top:6px;">
                            {% if comment.archived %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-bookmark-heart text-danger" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 4.41c1.387-1.425 4.854 1.07 0 4.277C3.146 5.48 6.613 2.986 8 4.412z"/>
                                <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/>
                            </svg>
                            {% endif %}
                        </span>
                    </div>
            </div>

        
        <div class="col-12">
            <div id="comment_content_{{comment.id}}">
                <div class="editor-area" id="editor-area_{{comment.id}}">
    
                </div>
                <div id="comment-body_{{comment.id}}" class="comment-body ps-0 pt-3">
                    <textarea style="display:none;">{{ comment.body|safe }}</textarea>
                </div>
                <script>
                    editormd.markdownToHTML("comment-body_{{comment.id}}", { 
                    emoji: true,
                    taskList: true,
                    tex: true,
                    flowChart: true,
                    sequenceDiagram: true,
                    codeFold: true
                });  
                </script>
            </div>
            <div class="d-flex flex-row">
                <div class="p-0" title="reply">
                    <a onclick="HandleReply({{comment.id}}, {{post.id}})">
                        <small class="clickable-text text-muted">Reply</small>
                    </a>
                </div>
                {% if comment.author.id == user.id %}
                <div class="p-0 ps-1 pe-1" title="edit">
                    <a onclick="HandleEdit({{comment.id}})">
                        <small class="clickable-text text-muted">Edit</small>
                    </a>
                </div>
                <div class="p-0 ps-1 pe-1" title="delete">
                    <a onclick="show_delete_comment({{comment.id}})">
                        <small class="clickable-text text-muted">Delete</small>
                    </a>
                </div>
                <div class="p-0 ps-0 pe-1">
                    <button type="button" id='post-option-dropdown-{{comment.id}}' title="more options" class="btn btn-sm btn-light dropdown-toggle dropdown-toggle-split border-0 bg-transparent text-muted" data-bs-toggle="dropdown" aria-expanded="false">
                        <span class="visually-hidden">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <small>
                                <a onclick="submit_comment_endorse({{comment.id}})" class="text-muted dropdown-item clickable-text" id="endose-comment-option-{{comment.id}}">
                                    {% if comment.endorsed %}
                                        Remove Endorse
                                    {% else %}
                                        Endorse
                                    {% endif %}
                                </a>
                            </small>
                        </li>
                        <li>
                            <small>
                                <a onclick="submit_comment_archive({{comment.id}})" class="text-muted dropdown-item clickable-text" id="archive-comment-option-{{comment.id}}">
                                    {% if comment.archived %}
                                        Remove from Archive
                                    {% else %}
                                        Add to Archive
                                    {% endif %}
                                </a>
                            </small>
                        </li>
                        {% if user.id == post.author.id %}
                            {% if post.solved_by_comment == 0 %}
                            <li class="solve-comment-list-item" id="solve-icon-{{comment.id}}" style="display:;">
                                <small>
                                    <a onclick="submit_comment_resolve({{comment.id}},{{comment.author.id}})" class="text-muted dropdown-item clickable-text" id="endose-comment-option-{{comment.id}}">
                                        Mark as solution
                                    </a>
                                </small>
                            </li>
                            {% else %}
                                {% if post.solved_by_comment == comment.id %}
                                <li class="solve-comment-list-item" id="solve-icon-{{comment.id}}" style="display:;">
                                    <small>
                                        <a onclick="submit_comment_resolve({{comment.id}},{{comment.author.id}})" class="text-muted dropdown-item clickable-text" id="endose-comment-option-{{comment.id}}">
                                            Cancel solution
                                        </a>
                                    </small>
                                </li>
                                {% else %}
                                <li class="solve-comment-list-item" id="solve-icon-{{comment.id}}" style="display:none;">
                                    <small>
                                        <a onclick="submit_comment_resolve({{comment.id}},{{comment.author.id}})" class="text-muted dropdown-item clickable-text" id="endose-comment-option-{{comment.id}}">
                                            Mark as solution
                                        </a>
                                    </small>
                                </li>
                                {% endif %}



                            {% endif %}
                        {% endif %}

                    </ul>
                </div>
                {% endif %}



            </div>


            <!-- <div class="ps-0">
                <div class="icon-wrapper" title="reply">
                    <a onclick="HandleReply({{comment.id}}, {{post.id}})" href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-reply text-dark" viewBox="0 0 16 16">
                        <path d="M6.598 5.013a.144.144 0 0 1 .202.134V6.3a.5.5 0 0 0 .5.5c.667 0 2.013.005 3.3.822.984.624 1.99 1.76 2.595 3.876-1.02-.983-2.185-1.516-3.205-1.799a8.74 8.74 0 0 0-1.921-.306 7.404 7.404 0 0 0-.798.008h-.013l-.005.001h-.001L7.3 9.9l-.05-.498a.5.5 0 0 0-.45.498v1.153c0 .108-.11.176-.202.134L2.614 8.254a.503.503 0 0 0-.042-.028.147.147 0 0 1 0-.252.499.499 0 0 0 .042-.028l3.984-2.933zM7.8 10.386c.068 0 .143.003.223.006.434.02 1.034.086 1.7.271 1.326.368 2.896 1.202 3.94 3.08a.5.5 0 0 0 .933-.305c-.464-3.71-1.886-5.662-3.46-6.66-1.245-.79-2.527-.942-3.336-.971v-.66a1.144 1.144 0 0 0-1.767-.96l-3.994 2.94a1.147 1.147 0 0 0 0 1.946l3.994 2.94a1.144 1.144 0 0 0 1.767-.96v-.667z"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-reply-fill text-primary" viewBox="0 0 16 16">
                            <path d="M5.921 11.9 1.353 8.62a.719.719 0 0 1 0-1.238L5.921 4.1A.716.716 0 0 1 7 4.719V6c1.5 0 6 0 7 8-2.5-4.5-7-4-7-4v1.281c0 .56-.606.898-1.079.62z"/>
                        </svg>
                        <small class="clickable-text text-muted">Reply</small>
                    </a>
                </div>

                
                {% if user.id == post.author.id %}
                
                    {% if post.solved_by_comment == 0 %}
                    
                    

                    
                    <div class="icon-wrapper solve" title="mark as solution" id="solve-icon-{{comment.id}}" style="display:;">
                        <a onclick="submit_comment_resolve({{comment.id}},{{comment.author.id}})">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle text-dark" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle-fill text-success" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                            </svg>
                        </a> 

                    </div>
                    {% else %}
                    
                        
                        {% if post.solved_by_comment == comment.id %}
                        <div class="icon-wrapper solve" title="mark as solution" id="solve-icon-{{comment.id}}" style="display:;">
                            <a onclick="submit_comment_resolve({{comment.id}},{{comment.author.id}})">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle text-dark" viewBox="0 0 16 16">
                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                    <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                                </svg>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle-fill text-success" viewBox="0 0 16 16">
                                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                </svg>
                            </a> 

                        </div>
                        {% else %}
                            <div class="icon-wrapper solve" title="mark as solution" id="solve-icon-{{comment.id}}" style="display: none;">
                                <a onclick="submit_comment_resolve({{comment.id}},{{comment.author.id}})">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle text-dark" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                                    </svg>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle-fill text-success" viewBox="0 0 16 16">
                                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                    </svg>
                                </a> 

                            </div>
                        {% endif %} 


                    {% endif %} 


                {% endif %}


                {% if comment.author.id == user.id %}
                <div class="icon-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-caret-down-square" viewBox="0 0 16 16" style="top: 2px;">
                        <path d="M3.626 6.832A.5.5 0 0 1 4 6h8a.5.5 0 0 1 .374.832l-4 4.5a.5.5 0 0 1-.748 0l-4-4.5z"/>
                        <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2z"/>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-caret-right-square" viewBox="0 0 16 16" style="top: 2px;">
                        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                        <path d="M5.795 12.456A.5.5 0 0 1 5.5 12V4a.5.5 0 0 1 .832-.374l4.5 4a.5.5 0 0 1 0 .748l-4.5 4a.5.5 0 0 1-.537.082z"/>
                    </svg>
                    <span class="separator">
                    <span class="text">
                        <small>
                                
                            <a onclick="HandleEdit({{comment.id}})" class="text-muted">Edit | </a>
                            <a onclick="show_delete_comment({{comment.id}})" class="text-muted">Delete | </a>
                            <a onclick="submit_comment_endorse({{comment.id}})" class="text-muted" id="endose-comment-option-{{comment.id}}">
                                {% if comment.endorsed %}
                                    Remove Endorse
                                {% else %}
                                    Endorse
                                {% endif %}
                            </a>
                        </small>
                    </span>
                </div>
                {% endif %}




            </div> -->

        </div>


            </div>


        </div>
        <!-- Delete -->
        <form method="POST" action="{% url 'delete_comment' comment.id %}">
            {% csrf_token %}
            <div class="comment-delete-form" id="comment-delete-form-{{comment.id}}">

            </div>
        </form>
        <div id="comment_reply_{{comment.id}}" class="editor-area">

        </div>

        
        
        
        <!-- <p>{{comment.body}}</p> -->
        <!-- <div class="mt-3">
            <strong>{{comment.author.first_name}} {{comment.author.last_name}}</strong>
            {% if  comment.parent.author %} to <strong>{{comment.parent.author.first_name}} {{comment.parent.author.last_name}}</strong>{% endif %}
            <small class="text-muted">On {{ comment.created.date }}</small>

            {% if comment.endorsed %} 
                <span class="badge rounded-pill text-bg-success">Endorsed</span>
            {% endif %}

        </div>
        <div id="comment_content_{{comment.id}}">
            <div class="editor-area" id="editor-area_{{comment.id}}">

            </div>
            <div id="comment-body_{{comment.id}}" class="comment-body">
                <textarea style="display:none;">{{ comment.body|safe }}</textarea>
            </div>
            <script>
                editormd.markdownToHTML("comment-body_{{comment.id}}", { 
                emoji: true,
                taskList: true,
                tex: true,
                flowChart: true,
                sequenceDiagram: true,
                codeFold: true
            });  
            </script>


        </div>

        <br>
        <a class="btn btn-primary btn-sm" href="#" onclick="HandleReply({{comment.id}}, {{post.id}})">Reply</a>
        {% if comment.author.id == user.id %} 
            <a class="btn btn-primary btn-sm" href="#" onclick="HandleEdit({{comment.id}})">Edit</a> 
            <button type="button" class="btn btn-danger btn-sm" onclick="show_delete_comment({{comment.id}})">
                Delete
            </button>
        {% endif %}
        {% if comment.id == post.solved_by_comment %} 
            <span class="badge rounded-pill text-bg-success">Solution</span>
        {% endif %}
        {% if user.id == post.author.id %}
            {% if post.solved_by_comment == 0 %}
                <button type="button" class="btn btn-success btn-sm" onclick="show_resolved({{comment.id}})">
                    Resolved
                </button> 
                <form method="POST" action="{% url 'solved_view' post.pk comment.author.id comment.id %}">
                    {% csrf_token %}
                    <div class="post-resolve-form" id="post-resolve-form-{{comment.id}}">

                    </div>
                </form>            

            {% endif %} 
        {% endif %} -->
        <!-- Endorse -->
        <!-- <form method="POST" action="{% url 'endorse_comment' post.id  comment.id %}">
            {% csrf_token %}
            <div class="comment-endorse-form" id="comment-endorse-form-{{comment.id}}">
                {% if comment.endorsed %}
                <button type="submit" class="btn btn-primary btn-sm">
                    Remove Endorse
                </button> 
                {% else %}
                <button type="submit" class="btn btn-primary btn-sm">
                    Endorse
                </button> 
                {% endif %}
            </div>
        </form>  -->
   




    </div>
    

    {% for comment in comment.get_comments %}
        {% include 'comment.html' with comment=comment %}
    {% endfor %}
</div>

